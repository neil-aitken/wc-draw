<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 World Cup - Group Composition Probabilities</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chart-section h2 {
            color: #2d3748;
            font-size: 1.3em;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .chart-container {
            height: 450px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #718096;
            font-size: 0.9em;
        }

        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .chart-container {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÜ 2026 World Cup Draw</h1>
        <p class="subtitle">Team Probabilities by Group</p>

        <div class="controls">
            <div class="control-group">
                <label for="groupSelect">Select Group</label>
                <select id="groupSelect">
                    <option value="A">Group A</option>
                    <option value="B">Group B</option>
                    <option value="C">Group C</option>
                    <option value="D">Group D</option>
                    <option value="E">Group E</option>
                    <option value="F">Group F</option>
                    <option value="G">Group G</option>
                    <option value="H">Group H</option>
                    <option value="I">Group I</option>
                    <option value="J">Group J</option>
                    <option value="K">Group K</option>
                    <option value="L">Group L</option>
                </select>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-section">
                <h2 id="position1Header">Position 1</h2>
                <div class="chart-container">
                    <canvas id="position1Chart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2 id="position2Header">Position 2</h2>
                <div class="chart-container">
                    <canvas id="position2Chart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2 id="position3Header">Position 3</h2>
                <div class="chart-container">
                    <canvas id="position3Chart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2 id="position4Header">Position 4</h2>
                <div class="chart-container">
                    <canvas id="position4Chart"></canvas>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Data based on FIFA official draw constraints simulation (50,000 draws)</p>
        </div>
    </div>

    <script>
        // Group position to pot mapping (from FIFA official schedule)
        const GROUP_POSITION_TO_POT = {
            'A': [1, 3, 2, 4],  // Position 1=Pot1, Position 2=Pot3, Position 3=Pot2, Position 4=Pot4
            'B': [1, 4, 3, 2],
            'C': [1, 2, 4, 3],
            'D': [1, 3, 2, 4],
            'E': [1, 4, 3, 2],
            'F': [1, 2, 4, 3],
            'G': [1, 3, 2, 4],
            'H': [1, 4, 3, 2],
            'I': [1, 2, 4, 3],
            'J': [1, 3, 2, 4],
            'K': [1, 4, 3, 2],
            'L': [1, 2, 4, 3]
        };

        let position1Chart = null;
        let position2Chart = null;
        let position3Chart = null;
        let position4Chart = null;
        let teamData = {};
        let teamPots = {};

        // Load teams and their pot assignments from CSV
        async function loadTeams() {
            const csvResponse = await fetch('teams.csv?v=' + Date.now());
            const csvText = await csvResponse.text();
            const lines = csvText.split('\n');

            for (const line of lines) {
                if (line.startsWith('#') || !line.trim()) continue;

                const parts = line.split(',');
                if (parts.length >= 3) {
                    const teamName = parts[0].trim();
                    const pot = parseInt(parts[2].trim());
                    teamPots[teamName] = pot;
                }
            }
        }

        // Load group probability data
        async function loadGroupData() {
            const response = await fetch('fifa_official_stats.json?v=' + Date.now());
            const data = await response.json();
            teamData = data.teams;
        }

        // Update chart with selected group
        async function updateChart(selectedGroup) {
            // Build probabilities for this group from all teams
            const allProbabilities = [];
            
            for (const [teamName, groups] of Object.entries(teamData)) {
                const prob = groups[selectedGroup];
                if (prob !== undefined && prob > 0) {
                    allProbabilities.push({ 
                        team: teamName, 
                        prob: prob,
                        pot: teamPots[teamName]
                    });
                }
            }

            // Get position-to-pot mapping for this group
            const potOrder = GROUP_POSITION_TO_POT[selectedGroup];

            // Update headers and render charts by position
            for (let position = 1; position <= 4; position++) {
                const pot = potOrder[position - 1];
                const header = document.getElementById(`position${position}Header`);
                header.textContent = `${selectedGroup}${position} (Pot ${pot})`;
                await renderPositionChart(`position${position}Chart`, pot, allProbabilities, selectedGroup, position);
            }
        }

        // Render chart for a specific position
        async function renderPositionChart(canvasId, potNumber, allProbabilities, selectedGroup, position) {
            // Filter for this pot and sort by probability
            const potTeams = allProbabilities
                .filter(item => item.pot === potNumber)
                .sort((a, b) => b.prob - a.prob);

            const teams = potTeams.map(item => item.team);
            const probabilities = potTeams.map(item => item.prob);

            // Get the chart instance variable
            let chartInstance;
            if (canvasId === 'position1Chart') chartInstance = position1Chart;
            else if (canvasId === 'position2Chart') chartInstance = position2Chart;
            else if (canvasId === 'position3Chart') chartInstance = position3Chart;
            else if (canvasId === 'position4Chart') chartInstance = position4Chart;

            // Destroy existing chart
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Create new chart
            const ctx = document.getElementById(canvasId).getContext('2d');
            const newChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teams,
                    datasets: [{
                        label: 'Probability (%)',
                        data: probabilities,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                        barPercentage: 0.8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 20,
                            top: 10,
                            bottom: 10
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#4a5568',
                                font: {
                                    size: 12
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Probability (%)',
                                color: '#2d3748',
                                font: {
                                    size: 13,
                                    weight: 'bold'
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#2d3748',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'rgba(255, 255, 255, 1)',
                            bodyColor: 'rgba(255, 255, 255, 0.9)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 2,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.x.toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });

            // Store the chart instance
            if (canvasId === 'position1Chart') position1Chart = newChart;
            else if (canvasId === 'position2Chart') position2Chart = newChart;
            else if (canvasId === 'position3Chart') position3Chart = newChart;
            else if (canvasId === 'position4Chart') position4Chart = newChart;
        }

        // Initialize
        async function init() {
            await loadTeams();
            await loadGroupData();

            const groupSelect = document.getElementById('groupSelect');
            updateChart(groupSelect.value);

            groupSelect.addEventListener('change', (e) => {
                updateChart(e.target.value);
            });
        }

        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 World Cup - Team Opponent Probabilities by Pot</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        label {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1em;
        }

        select {
            padding: 12px 20px;
            font-size: 1em;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            color: #2d3748;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 250px;
        }

        select:hover {
            border-color: #667eea;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .charts-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 30px;
        }

        .pots-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .bottom-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .chart-section {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 400px;
        }

        .team-info {
            text-align: center;
            padding: 20px;
            background: #edf2f7;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .team-info h2 {
            font-size: 2em;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .team-info .pot-label {
            font-size: 1.2em;
            color: #667eea;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-size: 1.2em;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #e53e3e;
            font-size: 1.2em;
        }

        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
            }

            .pots-row {
                grid-template-columns: 1fr;
            }

            .bottom-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš½ 2026 World Cup Opponent Analysis</h1>
        <p class="subtitle">Select a team to see their most likely opponents from each pot</p>

        <div class="controls">
            <label for="teamSelect">Choose a team:</label>
            <select id="teamSelect">
                <option value="">Loading teams...</option>
            </select>
        </div>

        <div id="teamInfo" class="team-info" style="display: none;">
            <h2 id="teamName"></h2>
            <div class="pot-label" id="teamPot"></div>
        </div>

        <div class="charts-container" id="chartsContainer">
            <div class="loading">Select a team to view opponent probabilities</div>
        </div>
    </div>

    <script>
        let drawStats = {};
        let teamPots = {};
        let teamCityData = {};
        let teamCandidates = {}; // Store playoff candidates
        let charts = [];
        
        // Load the data
        async function loadData() {
            try {
                // Load draw stats for opponent probabilities
                const statsResponse = await fetch('draw_stats.json?v=' + Date.now());
                drawStats = await statsResponse.json();

                // Load city probabilities
                const cityResponse = await fetch('team_city_probabilities.json?v=' + Date.now());
                teamCityData = await cityResponse.json();

                // Load team pots from teams.csv
                const csvResponse = await fetch('teams.csv?v=' + Date.now());
                const csvText = await csvResponse.text();
                
                // Parse CSV for pot information and candidates
                csvText.split('\n').forEach(line => {
                    if (line.startsWith('#') || !line.trim()) return;
                    const parts = line.split(',');
                    if (parts.length >= 3) {
                        const teamName = parts[0].trim();
                        const pot = parseInt(parts[2].trim());
                        teamPots[teamName] = pot;
                        
                        // Parse candidates (column 6, semicolon-separated)
                        if (parts.length >= 7 && parts[6].trim()) {
                            const candidates = parts[6].trim().split(';').map(c => c.trim());
                            teamCandidates[teamName] = candidates;
                        }
                    }
                });

                // Populate team dropdown
                const teamSelect = document.getElementById('teamSelect');
                teamSelect.innerHTML = '<option value="">-- Select a Team --</option>';
                
                const teams = Object.keys(drawStats.teams).sort();
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team;
                    const pot = teamPots[team] || '?';
                    
                    // Add candidates to dropdown label if available
                    let label = `${team} (Pot ${pot})`;
                    if (teamCandidates[team]) {
                        label = `${team} (${teamCandidates[team].join('/')})`;
                    }
                    
                    option.textContent = label;
                    teamSelect.appendChild(option);
                });

                teamSelect.addEventListener('change', (e) => {
                    if (e.target.value) {
                        updateCharts(e.target.value);
                    }
                });

            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('chartsContainer').innerHTML = 
                    '<div class="error">Error loading data. Please refresh the page.</div>';
            }
        }

        // Update charts for selected team
        function updateCharts(teamName) {
            // Show team info
            document.getElementById('teamInfo').style.display = 'block';
            
            // Display team name with candidates if available
            let displayName = teamName;
            if (teamCandidates[teamName]) {
                displayName = `${teamName} (${teamCandidates[teamName].join('/')})`;
            }
            document.getElementById('teamName').textContent = displayName;
            
            const teamPot = teamPots[teamName];
            document.getElementById('teamPot').textContent = `Pot ${teamPot}`;

            // Get opponent probabilities
            const teamData = drawStats.teams[teamName];
            if (!teamData || !teamData.pair_pct) {
                document.getElementById('chartsContainer').innerHTML = 
                    '<div class="error">No opponent data available for this team.</div>';
                return;
            }

            const opponents = teamData.pair_pct;
            const groupProbs = teamData.group_pct;

            // Group opponents by pot
            const opponentsByPot = { 1: [], 2: [], 3: [], 4: [] };
            
            for (const [opponent, prob] of Object.entries(opponents)) {
                const opponentPot = teamPots[opponent];
                if (opponentPot && opponentPot !== teamPot && prob > 0) {
                    opponentsByPot[opponentPot].push({ team: opponent, prob });
                }
            }

            // Sort each pot by probability
            for (const pot in opponentsByPot) {
                opponentsByPot[pot].sort((a, b) => b.prob - a.prob);
            }

            // Clear existing charts
            charts.forEach(chart => chart.destroy());
            charts = [];

            // Create chart sections
            const container = document.getElementById('chartsContainer');
            container.innerHTML = '';

            // Create top row for pot opponents (3 charts)
            const potsRow = document.createElement('div');
            potsRow.className = 'pots-row';
            container.appendChild(potsRow);

            // Determine which pots to show (exclude team's own pot)
            const potsToShow = [1, 2, 3, 4].filter(pot => pot !== teamPot);

            potsToShow.forEach(pot => {
                const opponents = opponentsByPot[pot];
                if (opponents.length === 0) return;

                // Create section
                const section = document.createElement('div');
                section.className = 'chart-section';
                
                const title = document.createElement('div');
                title.className = 'chart-title';
                title.textContent = `Pot ${pot} Opponents`;
                section.appendChild(title);

                const chartContainer = document.createElement('div');
                chartContainer.className = 'chart-container';
                const canvas = document.createElement('canvas');
                chartContainer.appendChild(canvas);
                section.appendChild(chartContainer);

                potsRow.appendChild(section);

                // Create chart
                const ctx = canvas.getContext('2d');
                const chart = createOpponentChart(ctx, opponents, pot);
                charts.push(chart);
            });

            // Create bottom row for cities and groups (2 charts)
            const bottomRow = document.createElement('div');
            bottomRow.className = 'bottom-row';
            container.appendChild(bottomRow);

            // Cities chart
            const cityProbs = teamCityData[teamName] || {};
            if (Object.keys(cityProbs).length > 0) {
                const citySection = document.createElement('div');
                citySection.className = 'chart-section';
                
                const cityTitle = document.createElement('div');
                cityTitle.className = 'chart-title';
                cityTitle.textContent = 'City Probabilities';
                citySection.appendChild(cityTitle);

                const cityChartContainer = document.createElement('div');
                cityChartContainer.className = 'chart-container';
                const cityCanvas = document.createElement('canvas');
                cityChartContainer.appendChild(cityCanvas);
                citySection.appendChild(cityChartContainer);

                bottomRow.appendChild(citySection);

                const cityCtx = cityCanvas.getContext('2d');
                const cityChart = createCityChart(cityCtx, cityProbs);
                charts.push(cityChart);
            }

            // Groups chart
            if (groupProbs && Object.keys(groupProbs).length > 0) {
                const groupSection = document.createElement('div');
                groupSection.className = 'chart-section';
                
                const groupTitle = document.createElement('div');
                groupTitle.className = 'chart-title';
                groupTitle.textContent = 'Group Probabilities';
                groupSection.appendChild(groupTitle);

                const groupChartContainer = document.createElement('div');
                groupChartContainer.className = 'chart-container';
                const groupCanvas = document.createElement('canvas');
                groupChartContainer.appendChild(groupCanvas);
                groupSection.appendChild(groupChartContainer);

                bottomRow.appendChild(groupSection);

                const groupCtx = groupCanvas.getContext('2d');
                const groupChart = createGroupChart(groupCtx, groupProbs);
                charts.push(groupChart);
            }
        }

        function createOpponentChart(ctx, opponents, pot) {
            const teams = opponents.map(o => o.team);
            const probabilities = opponents.map(o => o.prob);
            
            // Create labels with candidates for playoff teams
            const labels = teams.map(team => {
                if (teamCandidates[team]) {
                    return `${team} (${teamCandidates[team].join('/')})`;
                }
                return team;
            });

            // Color scheme by pot
            const potColors = {
                1: { base: 'rgba(220, 38, 38, 0.8)', border: 'rgba(220, 38, 38, 1)' },    // Red
                2: { base: 'rgba(234, 179, 8, 0.8)', border: 'rgba(234, 179, 8, 1)' },   // Yellow
                3: { base: 'rgba(34, 197, 94, 0.8)', border: 'rgba(34, 197, 94, 1)' },   // Green
                4: { base: 'rgba(59, 130, 246, 0.8)', border: 'rgba(59, 130, 246, 1)' }  // Blue
            };

            const colors = potColors[pot];

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Probability (%)',
                        data: probabilities,
                        backgroundColor: colors.base,
                        borderColor: colors.border,
                        borderWidth: 2,
                        borderRadius: 6,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Probability: ${context.parsed.x.toFixed(2)}%`;
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false,
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Probability (%)',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                color: '#4a5568'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                color: '#4a5568'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                color: '#2d3748',
                                autoSkip: false
                            }
                        }
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function createCityChart(ctx, cityProbs) {
            const cityNames = {
                'atlanta': 'Atlanta', 'boston': 'Boston', 'dallas': 'Dallas',
                'guadalajara': 'Guadalajara', 'houston': 'Houston', 'kansas-city': 'Kansas City',
                'los-angeles': 'Los Angeles', 'mexico-city': 'Mexico City', 'miami': 'Miami',
                'monterrey': 'Monterrey', 'new-york': 'New York/NJ', 'philadelphia': 'Philadelphia',
                'san-francisco': 'San Francisco', 'seattle': 'Seattle', 'toronto': 'Toronto',
                'vancouver': 'Vancouver'
            };

            const cities = Object.entries(cityProbs)
                .map(([city, prob]) => ({ city: cityNames[city] || city, prob }))
                .sort((a, b) => b.prob - a.prob);

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cities.map(c => c.city),
                    datasets: [{
                        label: 'Probability (%)',
                        data: cities.map(c => c.prob),
                        backgroundColor: 'rgba(139, 92, 246, 0.8)',
                        borderColor: 'rgba(139, 92, 246, 1)',
                        borderWidth: 2,
                        borderRadius: 6,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Probability: ${context.parsed.x.toFixed(2)}%`;
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Probability (%)',
                                font: { size: 12, weight: 'bold' },
                                color: '#4a5568'
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { color: '#4a5568' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 11 },
                                color: '#2d3748',
                                autoSkip: false
                            }
                        }
                    },
                    animation: { duration: 750, easing: 'easeInOutQuart' }
                }
            });
        }

        function createGroupChart(ctx, groupProbs) {
            const groups = Object.entries(groupProbs)
                .map(([group, prob]) => ({ group, prob }))
                .sort((a, b) => a.group.localeCompare(b.group));

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: groups.map(g => `Group ${g.group}`),
                    datasets: [{
                        label: 'Probability (%)',
                        data: groups.map(g => g.prob),
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 2,
                        borderRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Probability: ${context.parsed.y.toFixed(2)}%`;
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                font: { size: 11 },
                                color: '#2d3748'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Probability (%)',
                                font: { size: 12, weight: 'bold' },
                                color: '#4a5568'
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { color: '#4a5568' }
                        }
                    },
                    animation: { duration: 750, easing: 'easeInOutQuart' }
                }
            });
        }

        // Load data when page loads
        loadData();
    </script>
</body>
</html>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
